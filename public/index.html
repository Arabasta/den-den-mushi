<!DOCTYPE html>
<html>
<head>
    <title>xterm.js demo</title>
    <link rel="stylesheet" href="https://unpkg.com/xterm@latest/css/xterm.css"/>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #terminal {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
<div id="terminal"></div>
<script src="https://unpkg.com/xterm@latest/lib/xterm.js"></script>
<script src="https://unpkg.com/xterm-addon-fit@latest/lib/xterm-addon-fit.js"></script>
<script>
    const term = new Terminal();
    const fitAddon = new FitAddon.FitAddon();
    term.loadAddon(fitAddon);
    term.open(document.getElementById('terminal'));
    fitAddon.fit();

    // connect to WebSocket
    const ws = new WebSocket(`ws://${window.location.hostname}:45005`);

    // handle data from the server
    ws.onmessage = (event) => {
        console.log('Received from server:', event.data);
        term.write(event.data);
    };

    // send terminal input to server on Enter
    let currentInput = ''; // hold the current line being typed

    term.onData((data) => {
        // handle keys
        if (data === '\x7f') { // backspace
            currentInput = currentInput.slice(0, -1); // remove last char
            term.write('\b \b');  // delete char from screen
        }
        else if (data === '\r') { // enter key
            ws.send(currentInput + '\n'); // send input to server
            currentInput = '';  // reset current input
            term.write('\r\n'); // add newline after sending
        }
        else { // regular key
            currentInput += data; // add char
            term.write(data); // display char
        }
    });

    // handle window resize
    window.addEventListener('resize', () => fitAddon.fit());
</script>
</body>
</html>
